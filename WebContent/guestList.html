<!DOCTYPE HTML> 
<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="http://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript" src="http://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script>
	$.urlParam = function(name){
	    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
	    if (results==null){
	       return null;
	    }
	    else{
	       return results[1] || 0;
	    }
	}
    function selectChange() 
    {
        id = getId();
        $("#selectedID").html(id);
        $("#updateID").val(id);
        $("#deleteID").val(id);   
    }
    
    function getId()
	{ 
	  return jQuery( 'input[name=selectedRow]:checked' ).val()
	}
    function createTable() {
    	$.getJSON( "/eventplannerJava/eventplanner/guestservice/guestsbyguestlist/"+$.urlParam("id"))
    	  .done(function( response ) {
    		  var tableHTML = '<thead><tr><th></th><th>ID</th><th>Guest Name</th></tr></thead><tbody>';
    	        $.each(response, function (i, guest) {
    	            tableHTML += '<tr><td><input type="radio" onchange= "selectChange()" name="selectedRow" value='+guest.id+'><td>' + guest.id + '</td><td>' +guest.name + '</td></tr>';
    	        });
    	        tableHTML+='</tbody>';
    	       $('#guest-list-table').html(tableHTML);})
  	  .fail(function(jqXHR, textStatus, errorThrown) {
  		  	alert("Request failed");
  	        console.log("error " + textStatus);
  	        console.log("incoming Text " + jqXHR.responseText);});
      }
   var agree;
   $(document).ready(function(){
	   createTable();
        $('#guest-list-table').dataTable();     
	});
   
  function toAddScreen(){
   	var selectedId = getId();
   	window.location.assign('addGuest.html?eventid='+$.urlParam("id")+'&like=like');
   }
   
   function toUpdateScreen(){
   	var selectedId = getId();
   	window.location.assign('updateGuest.html?id='+getId()+'&event='+$.urlParam("id")+'&like=like');	
   }
   
	function confirmDeletion(){
		$.getJSON( "/eventplannerJava/eventplanner/guestservice/guests/"+getId())
		.done(function( response ) {
			console.log(response);
		    agree = confirm("Do you want to delete Guest: "+response.name+"?");
		     if(agree){
		    	//alert("Delete "+$("#deleteID").val());
		 		//alert("You confirmed the deletion");
		 		$.ajax({ 
		 			url:"/eventplannerJava/eventplanner/guestservice/guests/"+getId(),
		 			type: "DELETE",
		 		    success: (function(data) {
		 			  console.log("Delete success ");
		 			  window.location.assign("guestList.html?id="+$.urlParam('id')+"&ryder=ryder");
		 			  console.log("Delete after change href");
		 		  }),
		 		  fail: (function(jqXHR, textStatus, errorThrown) {
		 	 	      console.log("Delete error " + textStatus);
		 	 	      console.log("incoming Text " + jqXHR.responseText);
		 		  })

		 	  	 });
		 		console.log("end of delete")
		 	}else{
		 		//alert("You canceled the deletion");
	 			  window.location.assign("guestList.html?id="+$.urlParam('id')+"&ryder=ryder");
		 	}
			})
		.fail(function(jqXHR, textStatus, errorThrown) {
		    console.log("error " + textStatus);
		    console.log("incoming Text " + jqXHR.responseText);
		    });
	}
     
	function confirmLogout(){
	    agree = confirm("Do you want to logout?");
	     if(agree){
	 		window.location.assign("Logout.html");
	 	}
	}  

</script>
</head>
<body class="pageBody"> 
<div class= "container">
<div class=row>
<ul class="nav nav-pills" >
  <li role="presentation"><a href="eventsList.html">Events</a></li>
  <li role="presentation"><a href="customerList.html">Customers</a></li>
  <li role="presentation"><a href="userList.html">Users</a></li>
  <li class="logouttab pull-right" role="presentation"><a onclick ="confirmDeletion();" href="#">Logout</a></li>
</ul>
</div>
<h2>Guest List</h2>
<div>
<div class = "table-responsive">

<table class="table table-striped" id="guest-list-table" >
</table></div>
<br>

<p id="selectedID"></p>
<div class="footer-buttons inline">
<button id = "updatebtn" class="full btn btn-primary" type = "submit" name="submit" value="Update" onclick="toUpdateScreen()">Update</button>
<button id = "addbtn" class="full btn btn-primary" type = "submit" onclick="toAddScreen()">Add</button>
<button class="full btn btn-primary" onclick="confirmDeletion();" type = "submit" value="Delete">Delete</button>
</div>
</div>
</div>
</body>
</html>