<!DOCTYPE html>
<html lang="en">
<head>
  <title>Event Form</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <!--Font Awesome (added because you use icons in your prepend/append)-->
	<link rel="stylesheet" href="https://formden.com/static/cdn/font-awesome/4.4.0/css/font-awesome.min.css" />
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script>
  
    $(document).ready(function(){
    	 $("#customerselection").select2({
      	 	  ajax:{
     	            url: '/eventplannerJava/eventplanner/customerservice/customers',
     	            dataType: 'json',
     	            type: 'GET',
     	            processResults: function (data) {
     	                return {
     	                    results: $.map(data, function(obj) {
     	                        return { id: obj.id, text:obj.name};
     	                    })
     	                };
     	            }
     	        }
      	 	});
      	 $("#eventPlannerSelection").select2({
     	 	  ajax:{
     	            url: '/eventplannerJava/eventplanner/userservice/users',
     	            dataType: 'json',
     	            type: 'GET',
     	            processResults: function (data) {
     	                return {
     	                    results: $.map(data, function(obj) {
     	                        return { id: obj.id, text: obj.name};
     	                    })
     	                };
     	            }
     	        }
     	 	});
   	 $(".searchableselect").select2();
        var date_input=$('input[name="date"]'); //our date input has the name "date"
        var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
        date_input.datepicker({
            format: 'mm/dd/yyyy',
            container: container,
            todayHighlight: true,
            autoclose: true,
        })
        $("#save").click(function() {
        	//e.preventDefault();
        	var eventName = $('#eventName').val();
    		var selectedEventPlanner = $('#eventPlannerSelection').val();  
    		var selectedCustomer= $('#customerselection').val();  
    		var eventDate= $('#date').val();
    		var eventStatus= $('#status').val();
    		var eventLocation= $('#venueloc').val();
    		var eventMenu= $('#eventMenu').val();
    		var emptySeats= $('#emptySeats').val();
    		alert(selectedCustomer);
    	
    		$.ajax( { 
    			url:"/eventplannerJava/eventplanner/eventservice/events/",
    			type: "POST",
    			dataType: "json",
    			contentType: "application/json",
    			data: {
    				'name': eventName,
    				'date': eventDate,
    				'status' : eventStatus,
    				'location' : eventLocation,
    				'menu' : eventMenu,
    				'percentSeatsEmpty' : emptySeats,
    				assignedUser:{
    					'name':selectedEventPlanner,
    				},
    				customer:{
    					'name':selectedCustomer
    				}
    			},
    			statusCode: {
    				200: function(response) {
    	
    					  $("#page-message").html("Record Updated");
    					  window.location.assign("eventsList.html");
    			  	},
    			  	406: function(response) {
    			  		var errors = response.responseJSON;
    			  		$(".error").html("*");
    			  		$.each(errors, function (i, message) {
    			  			$("#"+message.attributeName+"Err").html(message.message);
    			  			console.log("Error "+message.attributeName +" "+message.message)
    	    	        		});
    			  		$("#page-message").html("Fix errors and click Save");
    			  	},
    			  	
    				404 : function(jqXHR, textStatus, errorThrown) {
    					$("#page-message").html("Error:"+textStatus);
    					consule.log(errorThrown);
    		  	        console.log("error " + textStatus);
    		  	        console.log("incoming Text " + jqXHR.responseText);
    		  	      }
    				}
    			});
    	
    		//e.preventDefault();
        	
        });
        $("#cancel").click(function(){
        	window.location.assign("eventsList.html");
        });
        $("#importbtn").click(function(){
        	//open the file picker
        });
    	$("#viewguestsbtn").click(function(){
    	    window.location.assign("guestList.html");
    	});
    	 $("#generateassignmentsbtn").click(function(){
    	 	window.location.assign("#");
    	 });
    	 $("#viewassignmentsbtn").click(function(){
    	 	window.location.assign("assignments.html");
    	 });
    	 
    	// Unneeded. The logic is handled by the vanilla JS functions below
    	 $("#seatingreportsa_zbtn").click(function(){
    	 	window.location.assign("#");
    	 });
    	 $("#reportsbytablebtn").click(function(){
    	 	window.location.assign("#")
    	 });
    	 $("#generatemarkersbtn").click(function(){
    		 //window.location.assign("#");	
    		 
    	 });
    });
    
    function confirmLogout(){
	    agree = confirm("Do you want to logout?");
	     if(agree){
	 		window.location.assign("Logout.html");
	 	}
	}
    
    // The following three methods work, but the IDs are hard coded.
    // There is no way to get the ID for an event that has yet to be
    // persisted, so we probably don't want these buttons on the add
    // screen to begin with.
    function generateTableMarkers() {
	    var req = new XMLHttpRequest();
		 req.open("GET", "/eventplannerJava/eventplanner/reportservice/events/1/tablemarkers", true);
		 req.responseType = "blob";
		 req.onload = function (event) {
			 var blob = req.response;
			 console.log(blob.size);
			 var link = document.createElement('a');
			 link.href = window.URL.createObjectURL(blob);
			 link.download = "TableMarkers_" + new Date() + ".pdf";
			 link.click();
		 };
		 req.send();
    }
    
    function generateSeatingReportTables() {
    	var req = new XMLHttpRequest();
		 req.open("GET", "/eventplannerJava/eventplanner/reportservice/events/1/tablenumberseatingreport", true);
		 req.responseType = "blob";
		 req.onload = function (event) {
			 var blob = req.response;
			 console.log(blob.size);
			 var link = document.createElement('a');
			 link.href = window.URL.createObjectURL(blob);
			 link.download = "SeatRepByTable_" + new Date() + ".pdf";
			 link.click();
		 };
		 req.send();
    }
    
    function generateSeatingReportAlpha() {
    	var req = new XMLHttpRequest();
		 req.open("GET", "/eventplannerJava/eventplanner/reportservice/events/2/alphabeticalseatingreport", true);
		 req.responseType = "blob";
		 req.onload = function (event) {
			 var blob = req.response;
			 console.log(blob.size);
			 var link = document.createElement('a');
			 link.href = window.URL.createObjectURL(blob);
			 link.download = "SeatRepByTable_" + new Date() + ".pdf";
			 link.click();
		 };
		 req.send();
    }
</script>
</head>
<body class="pageBody">

<div class="container">
<div class=row>
<ul class="nav nav-pills" >
  <li role="presentation"><a href="eventsList.html">Events</a></li>
  <li role="presentation"><a href="#">Customers</a></li>
  <li role="presentation"><a href="#">Users</a></li>
  <li class="logouttab pull-right" role="presentation"><a onclick ="confirmLogout();" href="#">Logout</a></li>
</ul>
</div>
<div class="formrow">
  <h3>Event Form</h3> 
   <h4>Event Information</h4>
  <div class="row">
  	  <form method="post">
    <div class="col-sm-6"> 
     <div class="form-group ">
      <label class="control-label requiredField" for="eventName">
       Event Name
       <span class="asteriskField">
        *
       </span>
      </label>
      <input class="form-control" id="eventName" name="eventName" type="text"/>
     </div>
       <div class="form-group ">
      <label class="control-label requiredField" for="date">
       Date
       <span class="asteriskField">
        *
       </span>
      </label>
      <div class="input-group">
       <div class="input-group-addon">
        <i class="fa fa-calendar-check-o">
        </i>
       </div>
       <input class="form-control" id="date" name="date" placeholder="MM/DD/YYYY" type="text"/>
      </div>
     </div>
     <div class="form-group ">
      <label class="control-label requiredField" for="venueloc">
       Venue
       <span class="asteriskField">
        *
       </span>
      </label>
      <input class="form-control" id="venueloc" name="venueloc" type="text"/>
     </div>
     <div class="form-group ">
      <label class="control-label requiredField" for="number">
       Percentage of Empty Seats
       <span class="asteriskField">
        *
       </span>
      </label>
      <input class="form-control" id="number" name="number" type="text"/>
     </div>

     <div class="form-group ">
      <label class="control-label requiredField" for="select1">
       Table Size
       <span class="asteriskField">
        *
       </span>
      </label>
      <select class="select form-control searchableselect" id="select1" name="select1">
       <option value="4">
        4
       </option>
       <option value="6">
        6
       </option>
       <option value="8">
        8
       </option>
      </select>
     </div>
    </div>
    <div class="col-sm-6">
    <div class="form-group ">
      <label class="control-label requiredField" for="select2">
       Table Shape
       <span class="asteriskField">
        *
       </span>
      </label>
      <select class="select form-control searchableselect" id="select2" name="select2">
       <option value="Square">
        Square
       </option>
       <option value="Rectangular">
        Rectangular
       </option>
       <option value="Circular">
        Circular
       </option>
      </select>
     </div>
 	<div class="form-group ">
      <label class="control-label requiredField" for="status">
       Event Status
       <span class="asteriskField">
        *
       </span>
      </label>
      <select class="select form-control searchableselect" id="status" name="status">
       <option value="Open">
        Open
       </option>
       <option value="Closed">
        Closed
       </option>
      </select>
     </div>
    <h4>Customer Information</h4>
     <div class="form-group">
      <label class="control-label requiredField" for = "customerselection">
      Customer Name
      <span class ="asteriskField">*</span>
      </label>
      <select class="form-control searchableselect1" id="customerselection" name ="customerselection" data-placeholder="Select an option">
      </select>
     </div>
     <h4>Office Information</h4>
     <div class="form-group ">
      <label class="control-label requiredField" for="eventPlannerSelection">
       Event Planner
       <span class="asteriskField">
        *
       </span>
      </label>
      <select class="select form-control searchableselect" id="eventPlannerSelection" name="eventPlannerSelection" data-placeholder="Select an option">
      </select>
     </div>
     </div>
    </form>
    </div>
    </div>
    <div class="pageFooter">
    <br><br>
    <div class ="row">
    <div class="col-md-3">
    <div class="form-group">
      <div>
       <button class="btn btn-primary " name="submit" type="submit" id="importbtn">
        Save and Import Guests
       </button>
      </div>
     </div>
   </div>
   <div class="col-md-3"><div class="form-group">
      <div>
       <button class="btn btn-primary " name="submit" type="submit" id="viewguestsbtn">
        View Guests
       </button>
      </div>
     </div>
    </div>
  <div class="col-md-3"><div class="form-group">
      <div>
       <button class="btn btn-primary " name="submit" type="submit" id="generateassignmentsbtn">
        Generate Seating Assignments
       </button>
      </div>
     </div></div>
   <div class="col-md-3"><div class="form-group">
      <div>
       <button class="btn btn-primary " name="submit" type="submit" id="viewassignmentsbtn">
        View Seating Assignments
       </button>
      </div>
     </div>
   </div>
    </div>
    <div class=row>
    <div class="col-md-3"><div class="form-group">
      <div>
       <button class="btn btn-primary " name="submit" type="submit" id="seatingreportsa_zbtn" onclick="generateSeatingReportAlpha()">
        Generate Seating Reports Alphabetically
       </button>
      </div>
     </div>
   </div>
   <div class="col-md-3"><div class="form-group">
      <div>
       <button class="btn btn-primary " name="submit" type="submit" id="reportsbytablebtn" onclick="generateSeatingReportTables()">
        Generate Seating Reports By Table
       </button>
      </div>
     </div>
     </div>
   <div class="col-md-3"><div class="form-group">
      <div>
       <button class="btn btn-primary " name="submit" type="submit" id="generatemarkersbtn" onclick="generateTableMarkers()">
        Generate Table Markers
       </button>
      </div>
     </div></div>
        <div class="col-md-1"><div class="form-group">
      <div >
       <button id="save" class="btn btn-primary " name="submit" type="submit">
        Save
       </button>
      </div>
     </div></div>
        <div class="col-md-1"><div class="form-group">
      <div>
       <button id="cancel" class="btn btn-primary" name="submit" type="submit">
        Cancel
       </button>
      </div>
     </div></div>
    </div>
    <br>
    </div>
</div> 
<br><br><br><br><br>
</body>
</html>
