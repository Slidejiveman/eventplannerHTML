<!DOCTYPE HTML> 
<html>
<head>
<link rel="stylesheet" type="text/css" href="style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

</head>
<body> 
<script>
$.urlParam = function(name){
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    if (results==null){
       return null;
    }
    else{
       return results[1] || 0;
    }
}

// This method is called when the page
// is loaded.
$(document).ready(function(){
	
	// Get the customer that you want the default values to display for
	$.ajax({
	    url: "/eventplannerJava/eventplanner/customerservice/customers/"+$.urlParam("id"),
	    type: 'GET',
	    datatype: 'json',
	    statusCode: {
	    200: function(response) {
	    	
	    	$('#customerName').val(response.name);
			$('#customerEmail').val(response.email);  
			$('#phone').val(response.phoneNumber);
			
			},
			
	    401:function( response ) {
	    		$('#page-messge').html("You must Login first");
	    		},
		403:function( response ) {
  	    		$('#page-messge').html("Access to the page forbiden");
  	    		}

	    		},
	    
	    error: function(jqXHR, textStatus, errorThrown) {
  	        console.log("error " + textStatus);
  	        console.log("incoming Text " + jqXHR.responseText);
  	        },  
	  });
	  
	// This should reference the form id
    $("#customerForm").submit(function(e) {
    	// These reference the text box ids
    	var customerName = $('#customerName').val();
		var customerEmail = $('#customerEmail').val();  
		var customerPhone= $('#phone').val();  
	
		// Ensure you are using the correct type and url here.
		//  This will put the updates in the database
		$.ajax( { 
			url:"/eventplannerJava/eventplanner/customerservice/customers/"+$.urlParam("id"),
			type: "PUT",
			dataType: "json",
			contentType: "application/json",
			data: '{'+
			'"name": "'+customerName+'",'+
			'"email": "'+customerEmail+'",'+
			'"phoneNumber" : "'+customerPhone+'"'+
		"}",
			statusCode: {
				200: function(response) {
	
					  $("#page-message").html("Record Added");
					  window.location.assign("customerList.html");
				},
			  	401:function( response ) {
	  	    			$('#page-message').html("You must Login first");
	  	    			},
	  	      	405:function( response ) {
	  		  	    	$('#page-message').html("Access to the page forbiden");
	  		  	    	},
			  	406: function(response) {
			  		var errors = response.responseJSON;
			  		$(".error").html("*");
			  		$.each(errors, function (i, message) {
			  			$("#"+message.attributeName+"Err").html(message.message);
			  			console.log("Error "+message.attributeName +" "+message.message)
	    	        		});
			  		$("#page-message").html("Fix errors and click Save");
			  	},
			  	
				404 : function(jqXHR, textStatus, errorThrown) {
					$("#page-message").html("Error:"+textStatus);
					console.log(errorThrown);
		  	        console.log("error " + textStatus);
		  	        console.log("incoming Text " + jqXHR.responseText);
		  	      }
				}
			});
	// Don't comment this out. It prevents the form from submitting
	// If none of the above responses are satisfied.
		e.preventDefault();
    	
    });
    $("#cancel").click(function(){
    	window.location.assign("customerList.html");
    });
}); // Do not forget these semi-colons.

// Needed to allow logout from this page.
function confirmLogout(){
    agree = confirm("Do you want to logout?");
     if(agree){
 		window.location.assign("Logout.html");
 	}
}
</script>
<div>
<ul class="nav">
<li><a href="eventList.html">Event</a></li>
<li><a href="customerList.html">Customer</a></li>
<li><a href="userList.html">Users</a></li>
<li class="logouttab pull-right" role="presentation"><a onclick ="confirmLogout();" href="#">Logout</a></li>
</ul>
</div>
<h2>Update Customer</h2>
<p id ='debug'></p>
<div class ='block-center'>
<p><span class="error-head">* required field.</span></p>
<!-- Ensure that all of these IDs are properly referenced 
     in the scripting section. -->
<form id="customerForm" method="post">  
   Customer Name: <input type="text" id="customerName">
   <span id="customerNameErr" class="error">* </span>
   <br><br>
   Customer Email: <input type="text" id="customerEmail">
   <span id="customerEmailErr" class="error">* </span>
   <br><br>
   Customer Phone: <input type="text" id="phone">
   <span id="phoneErr" class="error">* </span>
   <input type="submit" name="Add" value="Add"> 
</form>
<form action="customerList.html" method ="get">
<button type="submit" >Cancel</button>
</form>

</div>
</body>
</html>