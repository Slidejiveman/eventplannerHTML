<!DOCTYPE HTML> 
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="http://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
  <!--Font Awesome (added because you use icons in your prepend/append)-->
	<link rel="stylesheet" href="https://formden.com/static/cdn/font-awesome/4.4.0/css/font-awesome.min.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript" src="http://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script>
	function getCurrentUser() {
		$.ajax({
		    url: "/eventplannerJava/eventplanner/userservice/users/current",
		    type: 'GET',
		    datatype: 'json',
		    statusCode: {
		    200: function( response ) {
		
				$('#userWelcome').html("Welcome, "+response.firstName+" "+response.lastName);
		    },
		    401:function( response ) {
		    		$('#user-list-table').html("You must Login first");}
		    },
		    
		    error: function(jqXHR, textStatus, errorThrown) {
	  	        console.log("error " + textStatus);
	  	        console.log("incoming Text " + jqXHR.responseText);},
		    beforeSend: setHeader       
		  });   	
	}
	function getCookie(cname) {
	    var name = cname + "=";
	    var decodedCookie = decodeURIComponent(document.cookie);
	    var ca = decodedCookie.split(';');
	    for(var i = 0; i <ca.length; i++) {
	        var c = ca[i];
	        while (c.charAt(0) == ' ') {
	            c = c.substring(1);
	        }
	        if (c.indexOf(name) == 0) {
	            return c.substring(name.length, c.length);
	        }
	    }
	    return "";
	}
	
	function setHeader(xhr) {
		  token = getCookie("token");
		  xhr.setRequestHeader('Authorization', 'Bearer '+token );		  
	}
	createTable();
    function selectChange() 
    {
        id = getId();
        $("#selectedID").html(id);
        $("#updateID").val(id);
        $("#deleteID").val(id);   
    }
    
    function getId()
	{ 
	  return jQuery( 'input[name=selectedRow]:checked' ).val()
	}
    
    function createTable() {
    	//$.getJSON( "/eventplannerJava/eventplanner/userservice/users")
    	 /* .done(function( response ) {
    		  var tableHTML = '<thead><tr><th></th><th>ID</th><th>User Name</th></tr></thead><tbody>';
    	        $.each(response, function (i, user) {
    	            tableHTML += '<tr><td><input type="radio" onchange= "selectChange()" name="selectedRow" value='+user.id+'><td>'+ user.id+ '</td><td>' + user.name + '</td></tr>';
    	        });
    	        tableHTML+='</tbody>';
    	       $('#user-list-table').html(tableHTML);})
  	  .fail(function(jqXHR, textStatus, errorThrown) {
  	        console.log("error " + textStatus);
  	        console.log("incoming Text " + jqXHR.responseText);});
      },
      beforeSend: setHeader*/
      $.ajax({
    	  url:"/eventplannerJava/eventplanner/userservice/users",
    	  type:'GET',
    	  datatype:'json',
    	  statusCode:{
    		  	200:function(response){
        		  	var tableHTML = '<thead><tr><th></th><th>ID</th><th>User Name</th></tr></thead><tbody>';
        		  	$.each(response, function (i, user) {
        	            tableHTML += '<tr><td><input type="radio" onchange= "selectChange()" name="selectedRow" value='+user.id+'><td>'+ user.id+ '</td><td>' + user.name + '</td></tr>';
        	        });
        		  	tableHTML+='</tbody>';
        		  	$('#user-list-table').html(tableHTML);},
        		401:function( response ) {
          	    	$('#user-list-table').html("You must Login first");},
            	403:function( response ) {
          	    	$('#user-list-table').html("Access to the page forbiden");}
    	  	},
    	  	error: function(jqXHR, textStatus, errorThrown) {
      	        console.log("error " + textStatus);
      	        console.log("incoming Text " + jqXHR.responseText);},
    	    beforeSend: setHeader
    	});
   	}
   	
   	function confirmLogout(){
	    agree = confirm("Do you want to logout?");
	     if(agree){
	 		window.location.assign("Logout.html");
	 	}
	}
   	
</script>
<script>
	$(document).ready(function(){
    		$('#user-list-table').dataTable();
    		getCurrentUser();
    });
  
</script>
</head>
<body class="pageBody"> 
<div class= "container">
<div class=row>
<ul class="nav nav-pills" >
  <li role="presentation"><a href="eventsList.html">Events</a></li>
  <li role="presentation"><a href="customerList.html">Customers</a></li>
  <li role="presentation"><a href="userList.html">Users</a></li>
  <li class="logouttab pull-right" role="presentation"><a onclick ="confirmLogout();" href="#">Logout</a></li>
</ul>
</div>
<h2>User List</h2>
<div>
<div class = "table-responsive">

<table class='table table-striped' id='user-list-table'>
</table>
</div>
<br>
<p id="selectedID"></p>
<div class="footer-buttons">
<form class='inline' action="updateUser.html" method="get">
	<input id="updateID" type="hidden" name="id" value="">
     <button class="btn btn-primary" type = "submit" name="submit" value="Update">Update</button>
</form>

<form class='inline' action="addUser.html" method ="get">
     <button class="full btn btn-primary" type = "submit">Add</button>
</form>
<form class='inline'>
	<input id="deleteID" type="hidden" name="id" value="">
         
         <button class="full btn btn-primary" type = "submit" onClick="confirmDelete();" value="Delete">Delete</button>
 </form>
    <script>
    function confirmDelete(){
        var agree=confirm("Are you sure you want to delete this user?");
            if (agree){
            }else{
            
	    
	    }
        }
  
  </script>

</div>


 </div> 
</div>

</body>
</html>